{"ast":null,"code":"import { MultiCallABI } from '../constants';\nimport { BigNumber } from 'ethers';\nimport { useMulticallAddress } from './useMulticallAddress';\nimport { useRawCall } from './useRawCalls';\nimport { useChainId } from './useChainId';\nimport { useConfig } from './useConfig';\nimport { useBlockNumbers } from './useBlockNumbers';\nimport { useMemo } from 'react';\nconst GET_CURRENT_BLOCK_TIMESTAMP_CALL = MultiCallABI.encodeFunctionData('getCurrentBlockTimestamp', []);\nconst GET_CURRENT_BLOCK_DIFFICULTY_CALL = MultiCallABI.encodeFunctionData('getCurrentBlockDifficulty', []);\n/**\n * Queries block metadata.\n * @public\n */\nexport function useBlockMeta() {\n  let queryParams = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var _a, _b;\n  const chainId = useChainId({\n    queryParams\n  });\n  const {\n    refresh: configRefresh\n  } = useConfig();\n  const blockNumbers = useBlockNumbers();\n  const address = useMulticallAddress(queryParams);\n  const refresh = (_a = queryParams.refresh) !== null && _a !== void 0 ? _a : configRefresh;\n  const isStatic = (_b = queryParams.isStatic) !== null && _b !== void 0 ? _b : refresh === 'never';\n  const refreshPerBlocks = typeof refresh === 'number' ? refresh : undefined;\n  const timestampResult = useRawCall(address && chainId !== undefined && {\n    address,\n    data: GET_CURRENT_BLOCK_TIMESTAMP_CALL,\n    chainId,\n    isStatic,\n    refreshPerBlocks\n  });\n  const difficulty = useRawCall(address && chainId !== undefined && {\n    address,\n    data: GET_CURRENT_BLOCK_DIFFICULTY_CALL,\n    chainId,\n    isStatic,\n    refreshPerBlocks\n  });\n  const timestamp = useMemo(() => {\n    try {\n      return timestampResult !== undefined ? new Date(BigNumber.from(timestampResult.value).mul(1000).toNumber()) : undefined;\n    } catch (e) {\n      console.warn('Failed to parse timestamp of a block', e);\n    }\n  }, [timestampResult]);\n  return {\n    timestamp,\n    difficulty: difficulty !== undefined ? BigNumber.from(difficulty.value) : undefined,\n    blockNumber: chainId ? blockNumbers[chainId] : undefined\n  };\n}","map":{"version":3,"mappings":"AAAA,SAAkBA,YAAY,QAAQ,cAAc;AACpD,SAASC,SAAS,QAAQ,QAAQ;AAClC,SAASC,mBAAmB,QAAQ,uBAAuB;AAE3D,SAASC,UAAU,QAAQ,eAAe;AAC1C,SAASC,UAAU,QAAQ,cAAc;AACzC,SAASC,SAAS,QAAQ,aAAa;AACvC,SAASC,eAAe,QAAQ,mBAAmB;AACnD,SAASC,OAAO,QAAQ,OAAO;AAE/B,MAAMC,gCAAgC,GAAGR,YAAY,CAACS,kBAAkB,CAAC,0BAA0B,EAAE,EAAE,CAAC;AACxG,MAAMC,iCAAiC,GAAGV,YAAY,CAACS,kBAAkB,CAAC,2BAA2B,EAAE,EAAE,CAAC;AAE1G;;;;AAIA,OAAM,SAAUE,YAAY,GAA8B;EAAA,IAA7BC,kFAA2B,EAAE;;EACxD,MAAMC,OAAO,GAAGT,UAAU,CAAC;IAAEQ;EAAW,CAAE,CAAC;EAC3C,MAAM;IAAEE,OAAO,EAAEC;EAAa,CAAE,GAAGV,SAAS,EAAE;EAC9C,MAAMW,YAAY,GAAGV,eAAe,EAAE;EAEtC,MAAMW,OAAO,GAAGf,mBAAmB,CAACU,WAAW,CAAC;EAChD,MAAME,OAAO,GAAG,iBAAW,CAACA,OAAO,mCAAIC,aAAa;EACpD,MAAMG,QAAQ,GAAG,iBAAW,CAACA,QAAQ,mCAAIJ,OAAO,KAAK,OAAO;EAC5D,MAAMK,gBAAgB,GAAG,OAAOL,OAAO,KAAK,QAAQ,GAAGA,OAAO,GAAGM,SAAS;EAC1E,MAAMC,eAAe,GAAGlB,UAAU,CAChCc,OAAO,IACLJ,OAAO,KAAKO,SAAS,IAAI;IACvBH,OAAO;IACPK,IAAI,EAAEd,gCAAgC;IACtCK,OAAO;IACPK,QAAQ;IACRC;GACD,CACJ;EACD,MAAMI,UAAU,GAAGpB,UAAU,CAC3Bc,OAAO,IACLJ,OAAO,KAAKO,SAAS,IAAI;IACvBH,OAAO;IACPK,IAAI,EAAEZ,iCAAiC;IACvCG,OAAO;IACPK,QAAQ;IACRC;GACD,CACJ;EAED,MAAMK,SAAS,GAAGjB,OAAO,CAAC,MAAK;IAC7B,IAAI;MACF,OAAOc,eAAe,KAAKD,SAAS,GAChC,IAAIK,IAAI,CAACxB,SAAS,CAACyB,IAAI,CAACL,eAAe,CAACM,KAAK,CAAC,CAACC,GAAG,CAAC,IAAI,CAAC,CAACC,QAAQ,EAAE,CAAC,GACpET,SAAS;KACd,CAAC,OAAOU,CAAM,EAAE;MACfC,OAAO,CAACC,IAAI,CAAC,sCAAsC,EAAEF,CAAC,CAAC;;EAE3D,CAAC,EAAE,CAACT,eAAe,CAAC,CAAC;EAErB,OAAO;IACLG,SAAS;IACTD,UAAU,EAAEA,UAAU,KAAKH,SAAS,GAAGnB,SAAS,CAACyB,IAAI,CAACH,UAAU,CAACI,KAAK,CAAC,GAAGP,SAAS;IACnFa,WAAW,EAAEpB,OAAO,GAAGG,YAAY,CAACH,OAAkB,CAAC,GAAGO;GAC3D;AACH","names":["MultiCallABI","BigNumber","useMulticallAddress","useRawCall","useChainId","useConfig","useBlockNumbers","useMemo","GET_CURRENT_BLOCK_TIMESTAMP_CALL","encodeFunctionData","GET_CURRENT_BLOCK_DIFFICULTY_CALL","useBlockMeta","queryParams","chainId","refresh","configRefresh","blockNumbers","address","isStatic","refreshPerBlocks","undefined","timestampResult","data","difficulty","timestamp","Date","from","value","mul","toNumber","e","console","warn","blockNumber"],"sources":["/Users/jaleltounsi/Documents/GitHub/apexwave.fi/apexwave/node_modules/@usedapp/core/src/hooks/useBlockMeta.ts"],"sourcesContent":["import { ChainId, MultiCallABI } from '../constants'\nimport { BigNumber } from 'ethers'\nimport { useMulticallAddress } from './useMulticallAddress'\nimport { QueryParams } from '../constants/type/QueryParams'\nimport { useRawCall } from './useRawCalls'\nimport { useChainId } from './useChainId'\nimport { useConfig } from './useConfig'\nimport { useBlockNumbers } from './useBlockNumbers'\nimport { useMemo } from 'react'\n\nconst GET_CURRENT_BLOCK_TIMESTAMP_CALL = MultiCallABI.encodeFunctionData('getCurrentBlockTimestamp', [])\nconst GET_CURRENT_BLOCK_DIFFICULTY_CALL = MultiCallABI.encodeFunctionData('getCurrentBlockDifficulty', [])\n\n/**\n * Queries block metadata.\n * @public\n */\nexport function useBlockMeta(queryParams: QueryParams = {}) {\n  const chainId = useChainId({ queryParams })\n  const { refresh: configRefresh } = useConfig()\n  const blockNumbers = useBlockNumbers()\n\n  const address = useMulticallAddress(queryParams)\n  const refresh = queryParams.refresh ?? configRefresh\n  const isStatic = queryParams.isStatic ?? refresh === 'never'\n  const refreshPerBlocks = typeof refresh === 'number' ? refresh : undefined\n  const timestampResult = useRawCall(\n    address &&\n      chainId !== undefined && {\n        address,\n        data: GET_CURRENT_BLOCK_TIMESTAMP_CALL,\n        chainId,\n        isStatic,\n        refreshPerBlocks,\n      }\n  )\n  const difficulty = useRawCall(\n    address &&\n      chainId !== undefined && {\n        address,\n        data: GET_CURRENT_BLOCK_DIFFICULTY_CALL,\n        chainId,\n        isStatic,\n        refreshPerBlocks,\n      }\n  )\n\n  const timestamp = useMemo(() => {\n    try {\n      return timestampResult !== undefined\n        ? new Date(BigNumber.from(timestampResult.value).mul(1000).toNumber())\n        : undefined\n    } catch (e: any) {\n      console.warn('Failed to parse timestamp of a block', e)\n    }\n  }, [timestampResult])\n\n  return {\n    timestamp,\n    difficulty: difficulty !== undefined ? BigNumber.from(difficulty.value) : undefined,\n    blockNumber: chainId ? blockNumbers[chainId as ChainId] : undefined,\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}