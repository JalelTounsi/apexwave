{"ast":null,"code":"import { DEFAULT_SUPPORTED_CHAINS } from '../../../constants';\nimport { subscribeToProviderEvents } from '../../../helpers';\nimport { Event } from '../../../helpers/event';\nimport { getAddNetworkParams } from '../../../helpers/getAddNetworkParams';\nimport { validateArguments } from '../../../helpers/validateArgument';\nimport { DEFAULT_CONFIG } from '../../../model/config/default';\nimport { MetamaskConnector } from './implementations';\nexport class ConnectorController {\n  constructor(connector) {\n    let config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : DEFAULT_CONFIG;\n    this.connector = connector;\n    this.updated = new Event();\n    this.newBlock = new Event();\n    this.active = false;\n    this.accounts = [];\n    this.errors = [];\n    this._config = Object.assign({}, config);\n    connector.update.on(_ref => {\n      let {\n        chainId,\n        accounts\n      } = _ref;\n      this.chainId = chainId;\n      this.accounts = accounts;\n      this.emitUpdate();\n    });\n  }\n  emitUpdate() {\n    this.updated.emit({\n      active: this.active,\n      chainId: this.chainId,\n      accounts: this.accounts,\n      blockNumber: this.blockNumber,\n      errors: this.errors\n    });\n  }\n  updateConfig(config) {\n    this._config = Object.assign(Object.assign({}, this._config), config);\n  }\n  getProvider() {\n    return this.connector.provider;\n  }\n  async activate() {\n    let connectorActivator = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : connector => connector.activate();\n    await connectorActivator(this.connector);\n    const provider = this.getProvider();\n    if (!provider) {\n      throw new Error('Failed to activate connector');\n    }\n    this.clearSubscriptions = subscribeToProviderEvents(this.connector, _ref2 => {\n      let {\n        chainId,\n        accounts\n      } = _ref2;\n      if (chainId !== undefined) {\n        this.chainId = chainId;\n      }\n      if (accounts !== undefined) {\n        this.accounts = accounts;\n      }\n      this.emitUpdate();\n    }, () => {\n      if (this.connector instanceof MetamaskConnector && this._config.noMetamaskDeactivate) {\n        return;\n      }\n      void this.deactivate();\n    });\n    this.blockNumber = await provider.getBlockNumber();\n    this.newBlock.emit(this.blockNumber);\n    this.removeBlockEffect = this.newBlock.addEffect(() => {\n      const listener = blockNumber => {\n        this.blockNumber = blockNumber;\n        this.newBlock.emit(blockNumber);\n        this.emitUpdate();\n      };\n      provider.on('block', listener);\n      return () => {\n        provider.off('block', listener);\n      };\n    });\n    this.emitUpdate();\n  }\n  async deactivate() {\n    var _a, _b;\n    this.active = false;\n    (_a = this.removeBlockEffect) === null || _a === void 0 ? void 0 : _a.call(this);\n    (_b = this.clearSubscriptions) === null || _b === void 0 ? void 0 : _b.call(this);\n    await this.connector.deactivate();\n    this.chainId = undefined;\n    this.accounts = [];\n    this.blockNumber = undefined;\n    this.errors = [];\n    this.emitUpdate();\n  }\n  async switchNetwork(chainId) {\n    var _a;\n    const provider = this.getProvider();\n    validateArguments({\n      chainId\n    }, {\n      chainId: 'number'\n    });\n    if (!provider) {\n      throw new Error('Connector not initialized');\n    }\n    try {\n      await provider.send('wallet_switchEthereumChain', [{\n        chainId: `0x${chainId.toString(16)}`\n      }]);\n    } catch (error) {\n      const errChainNotAddedYet = 4902; // Metamask error code\n      if (error.code === errChainNotAddedYet) {\n        const chain = ((_a = this._config.networks) !== null && _a !== void 0 ? _a : DEFAULT_SUPPORTED_CHAINS).find(chain => chain.chainId === chainId);\n        if (!chain) throw new Error(`ChainId \"${chainId}\" not found in config.networks. See https://usedapp-docs.netlify.app/docs/Guides/Transactions/Switching%20Networks`);\n        if (!chain.rpcUrl) throw new Error(`ChainId \"${chainId}\" does not have RPC url configured by default. See https://usedapp-docs.netlify.app/docs/Guides/Transactions/Switching%20Networks`);\n        await provider.send('wallet_addEthereumChain', [getAddNetworkParams(chain)]);\n      } else {\n        throw error;\n      }\n    }\n  }\n  reportError(error) {\n    this.errors.push(error);\n    this.emitUpdate();\n  }\n}","map":{"version":3,"mappings":"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","names":["DEFAULT_SUPPORTED_CHAINS","subscribeToProviderEvents","Event","getAddNetworkParams","validateArguments","DEFAULT_CONFIG","MetamaskConnector","ConnectorController","constructor","connector","config","_config","update","on","chainId","accounts","emitUpdate","updated","emit","active","blockNumber","errors","updateConfig","getProvider","provider","activate","connectorActivator","Error","clearSubscriptions","undefined","noMetamaskDeactivate","deactivate","getBlockNumber","newBlock","removeBlockEffect","addEffect","listener","off","switchNetwork","send","toString","error","errChainNotAddedYet","code","chain","networks","find","rpcUrl","reportError","push"],"sources":["/Users/jaleltounsi/Documents/GitHub/apexwave.fi/apexwave/node_modules/@usedapp/core/src/providers/network/connectors/connectorController.ts"],"sourcesContent":["import { providers } from 'ethers'\nimport { DEFAULT_SUPPORTED_CHAINS, FullConfig } from '../../../constants'\nimport { subscribeToProviderEvents } from '../../../helpers'\nimport { Event } from '../../../helpers/event'\nimport { getAddNetworkParams } from '../../../helpers/getAddNetworkParams'\nimport { validateArguments } from '../../../helpers/validateArgument'\nimport { DEFAULT_CONFIG } from '../../../model/config/default'\nimport { Connector } from './connector'\nimport { MetamaskConnector } from './implementations'\n\nexport interface ControllerUpdateInfo {\n  active: ConnectorController['active']\n  accounts: ConnectorController['accounts']\n  chainId: ConnectorController['chainId']\n  blockNumber: ConnectorController['blockNumber']\n  errors: ConnectorController['errors']\n}\n\nexport class ConnectorController {\n  readonly updated = new Event<ControllerUpdateInfo>()\n  readonly newBlock = new Event<number>()\n\n  public active = false\n  public accounts: string[] = []\n  public chainId: number | undefined\n  public blockNumber: number | undefined\n  public errors: Error[] = []\n\n  private _config: FullConfig\n\n  private emitUpdate() {\n    this.updated.emit({\n      active: this.active,\n      chainId: this.chainId,\n      accounts: this.accounts,\n      blockNumber: this.blockNumber,\n      errors: this.errors,\n    })\n  }\n\n  public updateConfig(config: Partial<FullConfig>) {\n    this._config = {\n      ...this._config,\n      ...config,\n    }\n  }\n\n  private removeBlockEffect?: () => void\n  private clearSubscriptions?: () => void\n\n  constructor(public readonly connector: Connector, config: FullConfig = DEFAULT_CONFIG) {\n    this._config = { ...config }\n    connector.update.on(({ chainId, accounts }) => {\n      this.chainId = chainId\n      this.accounts = accounts\n      this.emitUpdate()\n    })\n  }\n\n  getProvider(): providers.Web3Provider | providers.JsonRpcProvider | undefined {\n    return this.connector.provider\n  }\n\n  async activate(connectorActivator = (connector: Connector) => connector.activate()) {\n    await connectorActivator(this.connector)\n    const provider = this.getProvider()\n    if (!provider) {\n      throw new Error('Failed to activate connector')\n    }\n\n    this.clearSubscriptions = subscribeToProviderEvents(\n      this.connector,\n      ({ chainId, accounts }) => {\n        if (chainId !== undefined) {\n          this.chainId = chainId\n        }\n        if (accounts !== undefined) {\n          this.accounts = accounts\n        }\n        this.emitUpdate()\n      },\n      () => {\n        if (this.connector instanceof MetamaskConnector && this._config.noMetamaskDeactivate) {\n          return\n        }\n        void this.deactivate()\n      }\n    )\n\n    this.blockNumber = await provider.getBlockNumber()\n    this.newBlock.emit(this.blockNumber)\n    this.removeBlockEffect = this.newBlock.addEffect(() => {\n      const listener = (blockNumber: number) => {\n        this.blockNumber = blockNumber\n        this.newBlock.emit(blockNumber)\n        this.emitUpdate()\n      }\n\n      provider.on('block', listener)\n\n      return () => {\n        provider.off('block', listener)\n      }\n    })\n\n    this.emitUpdate()\n  }\n\n  async deactivate() {\n    this.active = false\n    this.removeBlockEffect?.()\n    this.clearSubscriptions?.()\n    await this.connector.deactivate()\n    this.chainId = undefined\n    this.accounts = []\n    this.blockNumber = undefined\n    this.errors = []\n    this.emitUpdate()\n  }\n\n  async switchNetwork(chainId: number) {\n    const provider = this.getProvider()\n\n    validateArguments({ chainId }, { chainId: 'number' })\n\n    if (!provider) {\n      throw new Error('Connector not initialized')\n    }\n\n    try {\n      await provider.send('wallet_switchEthereumChain', [{ chainId: `0x${chainId.toString(16)}` }])\n    } catch (error: any) {\n      const errChainNotAddedYet = 4902 // Metamask error code\n      if (error.code === errChainNotAddedYet) {\n        const chain = (this._config.networks ?? DEFAULT_SUPPORTED_CHAINS).find((chain) => chain.chainId === chainId)\n        if (!chain)\n          throw new Error(\n            `ChainId \"${chainId}\" not found in config.networks. See https://usedapp-docs.netlify.app/docs/Guides/Transactions/Switching%20Networks`\n          )\n        if (!chain.rpcUrl)\n          throw new Error(\n            `ChainId \"${chainId}\" does not have RPC url configured by default. See https://usedapp-docs.netlify.app/docs/Guides/Transactions/Switching%20Networks`\n          )\n        await provider.send('wallet_addEthereumChain', [getAddNetworkParams(chain)])\n      } else {\n        throw error\n      }\n    }\n  }\n\n  reportError(error: Error) {\n    this.errors.push(error)\n    this.emitUpdate()\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}