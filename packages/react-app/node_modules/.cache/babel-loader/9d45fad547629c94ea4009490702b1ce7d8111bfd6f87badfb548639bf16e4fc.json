{"ast":null,"code":"import { Contract } from 'ethers';\nimport { decodeTryAggregate, encodeTryAggregate } from '../../../abi/multicall2';\nconst ABI = ['function tryAggregate(bool requireSuccess, tuple(address target, bytes callData)[] calls) public view returns (tuple(bool success, bytes returnData)[])'];\n/**\n * @public\n */\nexport const multicall2Factory = fastEncoding => fastEncoding ? fastEncodingMulticall2 : multicall2;\n/**\n * @public\n */\nexport async function multicall2(provider, address, blockNumber, requests) {\n  if (requests.length === 0) {\n    return {};\n  }\n  const contract = new Contract(address, ABI, provider);\n  const results = await contract.tryAggregate(false, requests.map(_ref => {\n    let {\n      address,\n      data\n    } = _ref;\n    return [address, data];\n  }), {\n    blockTag: blockNumber\n  });\n  return decodeResult(results, requests);\n}\n/**\n * @public\n */\nexport async function fastEncodingMulticall2(provider, address, blockNumber, requests) {\n  if (requests.length === 0) {\n    return {};\n  }\n  const response = await provider.call({\n    to: address,\n    data: encodeTryAggregate(false, requests.map(_ref2 => {\n      let {\n        address,\n        data\n      } = _ref2;\n      return [address, data];\n    }))\n  }, blockNumber);\n  const [results] = decodeTryAggregate(response);\n  return decodeResult(results, requests);\n}\nfunction decodeResult(results, requests) {\n  var _a;\n  const state = {};\n  for (let i = 0; i < requests.length; i++) {\n    const {\n      address,\n      data\n    } = requests[i];\n    const [success, value] = results[i];\n    const stateForAddress = (_a = state[address]) !== null && _a !== void 0 ? _a : {};\n    stateForAddress[data] = {\n      success,\n      value\n    };\n    state[address] = stateForAddress;\n  }\n  return state;\n}","map":{"version":3,"mappings":"AAAA,SAASA,QAAQ,QAAmB,QAAQ;AAC5C,SAASC,kBAAkB,EAAEC,kBAAkB,QAAQ,yBAAyB;AAIhF,MAAMC,GAAG,GAAG,CACV,yJAAyJ,CAC1J;AAED;;;AAGA,OAAO,MAAMC,iBAAiB,GAAIC,YAAqB,IAAMA,YAAY,GAAGC,sBAAsB,GAAGC,UAAW;AAEhH;;;AAGA,OAAO,eAAeA,UAAU,CAC9BC,QAA4B,EAC5BC,OAAe,EACfC,WAAmB,EACnBC,QAAmB;EAEnB,IAAIA,QAAQ,CAACC,MAAM,KAAK,CAAC,EAAE;IACzB,OAAO,EAAE;;EAEX,MAAMC,QAAQ,GAAG,IAAIb,QAAQ,CAACS,OAAO,EAAEN,GAAG,EAAEK,QAAQ,CAAC;EACrD,MAAMM,OAAO,GAAwB,MAAMD,QAAQ,CAACE,YAAY,CAC9D,KAAK,EACLJ,QAAQ,CAACK,GAAG,CAAC;IAAA,IAAC;MAAEP,OAAO;MAAEQ;IAAI,CAAE;IAAA,OAAK,CAACR,OAAO,EAAEQ,IAAI,CAAC;EAAA,EAAC,EACpD;IAAEC,QAAQ,EAAER;EAAW,CAAE,CAC1B;EACD,OAAOS,YAAY,CAACL,OAAO,EAAEH,QAAQ,CAAC;AACxC;AAEA;;;AAGA,OAAO,eAAeL,sBAAsB,CAC1CE,QAA4B,EAC5BC,OAAe,EACfC,WAAmB,EACnBC,QAAmB;EAEnB,IAAIA,QAAQ,CAACC,MAAM,KAAK,CAAC,EAAE;IACzB,OAAO,EAAE;;EAEX,MAAMQ,QAAQ,GAAG,MAAMZ,QAAQ,CAACa,IAAI,CAClC;IACEC,EAAE,EAAEb,OAAO;IACXQ,IAAI,EAAEf,kBAAkB,CACtB,KAAK,EACLS,QAAQ,CAACK,GAAG,CAAC;MAAA,IAAC;QAAEP,OAAO;QAAEQ;MAAI,CAAE;MAAA,OAAK,CAACR,OAAO,EAAEQ,IAAI,CAAC;IAAA,EAAC;GAEvD,EACDP,WAAW,CACZ;EACD,MAAM,CAACI,OAAO,CAAC,GAAGb,kBAAkB,CAACmB,QAAQ,CAAC;EAC9C,OAAOD,YAAY,CAACL,OAAO,EAAEH,QAAQ,CAAC;AACxC;AAEA,SAASQ,YAAY,CAACL,OAA4B,EAAEH,QAAmB;;EACrE,MAAMY,KAAK,GAAe,EAAE;EAC5B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGb,QAAQ,CAACC,MAAM,EAAEY,CAAC,EAAE,EAAE;IACxC,MAAM;MAAEf,OAAO;MAAEQ;IAAI,CAAE,GAAGN,QAAQ,CAACa,CAAC,CAAC;IACrC,MAAM,CAACC,OAAO,EAAEC,KAAK,CAAC,GAAGZ,OAAO,CAACU,CAAC,CAAC;IACnC,MAAMG,eAAe,GAAG,WAAK,CAAClB,OAAO,CAAC,mCAAI,EAAE;IAC5CkB,eAAe,CAACV,IAAI,CAAC,GAAG;MAAEQ,OAAO;MAAEC;IAAK,CAAE;IAC1CH,KAAK,CAACd,OAAO,CAAC,GAAGkB,eAAe;;EAElC,OAAOJ,KAAK;AACd","names":["Contract","decodeTryAggregate","encodeTryAggregate","ABI","multicall2Factory","fastEncoding","fastEncodingMulticall2","multicall2","provider","address","blockNumber","requests","length","contract","results","tryAggregate","map","data","blockTag","decodeResult","response","call","to","state","i","success","value","stateForAddress"],"sources":["/Users/jaleltounsi/Documents/GitHub/apexwave.fi/apexwave/node_modules/@usedapp/core/src/providers/chainState/common/multicall2.ts"],"sourcesContent":["import { Contract, providers } from 'ethers'\nimport { decodeTryAggregate, encodeTryAggregate } from '../../../abi/multicall2'\nimport { RawCall } from './callsReducer'\nimport { ChainState } from './model'\n\nconst ABI = [\n  'function tryAggregate(bool requireSuccess, tuple(address target, bytes callData)[] calls) public view returns (tuple(bool success, bytes returnData)[])',\n]\n\n/**\n * @public\n */\nexport const multicall2Factory = (fastEncoding: boolean) => (fastEncoding ? fastEncodingMulticall2 : multicall2)\n\n/**\n * @public\n */\nexport async function multicall2(\n  provider: providers.Provider,\n  address: string,\n  blockNumber: number,\n  requests: RawCall[]\n): Promise<ChainState> {\n  if (requests.length === 0) {\n    return {}\n  }\n  const contract = new Contract(address, ABI, provider)\n  const results: [boolean, string][] = await contract.tryAggregate(\n    false,\n    requests.map(({ address, data }) => [address, data]),\n    { blockTag: blockNumber }\n  )\n  return decodeResult(results, requests)\n}\n\n/**\n * @public\n */\nexport async function fastEncodingMulticall2(\n  provider: providers.Provider,\n  address: string,\n  blockNumber: number,\n  requests: RawCall[]\n): Promise<ChainState> {\n  if (requests.length === 0) {\n    return {}\n  }\n  const response = await provider.call(\n    {\n      to: address,\n      data: encodeTryAggregate(\n        false,\n        requests.map(({ address, data }) => [address, data])\n      ),\n    },\n    blockNumber\n  )\n  const [results] = decodeTryAggregate(response)\n  return decodeResult(results, requests)\n}\n\nfunction decodeResult(results: [boolean, string][], requests: RawCall[]) {\n  const state: ChainState = {}\n  for (let i = 0; i < requests.length; i++) {\n    const { address, data } = requests[i]\n    const [success, value] = results[i]\n    const stateForAddress = state[address] ?? {}\n    stateForAddress[data] = { success, value }\n    state[address] = stateForAddress\n  }\n  return state\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}